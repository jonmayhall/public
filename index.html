<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="x-ua-compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>myKaarma – Onsite Training Checklist</title>
  <style>
    :root{
      --bg:#fff; --ink:#111;
      --orange:#F36F21; --green:#B7D33B;
      --field:#FAFAFA; --border:#e3e7eb;
      --w:1100px; --header:#333333;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);
      font-family:"Helvetica Neue", Helvetica, Arial, sans-serif;line-height:1.45}
    .app{max-width:var(--w);margin:0 auto;padding:20px}

    /* Tabs */
    .tabs{display:flex;flex-wrap:wrap;gap:8px;margin:8px 0 18px}
    .tab{padding:6px 12px;border:1px solid var(--border);border-radius:999px;cursor:pointer;background:#fff;font-size:12px}
    .tab.active{background:var(--ink);color:#fff;border-color:var(--ink)}

    /* Pages */
    .page{display:none;page-break-after:always}
    .page.active{display:block}

    /* Header: logo left, title + subline stacked to its right */
    .page-header{
      display:grid;
      grid-template-columns:auto 1fr;
      grid-template-rows:auto auto;
      column-gap:14px; row-gap:6px;
      align-items:center;
      background:var(--header); color:#fff;
      border:2px solid var(--header);
      border-radius:16px; padding:16px; margin-bottom:16px;
    }
    .logo{height:44px; width:auto; object-fit:contain; grid-row:1 / span 2; align-self:center}
    .header-title{font-weight:900; font-size:24px; letter-spacing:.2px; margin:0}
    .header-subline{
      font-weight:600; font-size:14px; outline:none;
      border-radius:8px; padding:2px 6px; background:transparent; color:#fff;
    }
    .header-subline[contenteditable]:empty:before{content: attr(data-ph); color:#ffffffcc}

    /* Toolbar */
    .toolbar{display:flex;flex-wrap:wrap;gap:8px;margin:8px 0 16px}
    .btn{padding:6px 10px;border-radius:10px;border:1px solid var(--border);background:#fff;cursor:pointer;font-size:12px}
    .btn.outline{background:transparent}
    .btn.file input{display:none}

    /* Section framing */
    .section{margin:20px 0;border:1px solid var(--orange);border-radius:16px;background:#fff;overflow:hidden}
    .section-title{
      display:block;background:var(--orange);color:#fff;
      border-bottom:1px solid var(--orange);
      padding:10px 16px;font-size:16px;font-weight:800;letter-spacing:.2px;
    }
    .section-body{
      border:2px solid var(--green);
      border-radius:14px;
      margin:12px; padding:14px; background:#fff;
    }

    /* Subsections */
    .subsection-title{
      display:block; background:#fff5ef; color:#5a2d0f;
      border:1px solid var(--orange); border-radius:10px;
      padding:8px 12px; font-size:13px; font-weight:800;
      margin:6px 0 0;
    }
    /* Level-2 (dotted light-green) */
    .subsection-title.level-2{
      background:#f4fbec; color:#223;
      border:1px dashed var(--orange);
      margin-left:30px; margin-right:30px;
      border-bottom-left-radius:0; border-bottom-right-radius:0;
    }
    /* Connect box under dotted subheader */
    .subgroup{
      border:1px solid var(--orange); border-top:none;
      margin:0 30px 12px 30px; padding:12px;
      border-bottom-left-radius:8px; border-bottom-right-radius:8px;
      background:#fff;
    }

    /* Questions */
    .q{margin:10px 0}
    .q-row{display:grid;grid-template-columns:1fr 300px;gap:14px;align-items:start}
    .q-row.wide{grid-template-columns:1fr}
    .label{font-weight:600;font-size:12px;color:#222;margin-top:2px}
    .select,.textarea,.textinput{
      width:100%;font-size:12px;padding:8px 10px;border:1px solid var(--border);
      border-radius:8px;background:var(--field)
    }
    .select{height:34px}
    .textarea{min-height:100px;resize:none}
    .textinput{height:34px}

    /* Indentation helpers */
    .indent-1{margin-left:28px}
    .indent-2{margin-left:48px}
    .indent-3{margin-left:72px}
    .indent-4{margin-left:96px}

    /* Extra indentation on the two key pages */
    .page[data-page="Handoff & Review"] .q,
    .page[data-page="Contacts & WiFi"] .q{margin-left:30px}
    .page[data-page="Handoff & Review"] .q.indent-1,
    .page[data-page="Contacts & WiFi"] .q.indent-1{margin-left:60px}
    .page[data-page="Handoff & Review"] .q.indent-2,
    .page[data-page="Contacts & WiFi"] .q.indent-2{margin-left:90px}
    .page[data-page="Handoff & Review"] .q.indent-3,
    .page[data-page="Contacts & WiFi"] .q.indent-3{margin-left:120px}
    .page[data-page="Handoff & Review"] .q.indent-4,
    .page[data-page="Contacts & WiFi"] .q.indent-4{margin-left:150px}

    /* Footer (Option A – Inline) */
    .footer{display:flex;gap:24px;align-items:center;justify-content:flex-end;margin-top:14px;color:#333;font-size:12px}
    .footer .fblock{display:flex;align-items:center;gap:8px}
    .footer .line{display:inline-block;min-width:180px;border-bottom:1px solid #333;height:16px}

    @media (max-width: 840px){
      .q-row{grid-template-columns:1fr}
      .footer{flex-direction:column;align-items:flex-start;gap:8px}
      .footer .line{min-width:220px}
    }
    @media print{
      .tabs,.toolbar{display:none !important}
      .page{display:block !important;page-break-after:always}
      .section-body{break-inside:avoid}
    }

    .warn{background:#fff3cd;border:1px solid #ffeeba;color:#856404;padding:10px;border-radius:8px;margin:10px 0;font-size:13px}
  </style>
</head>
<body>
  <noscript><div class="warn">This app needs JavaScript enabled.</div></noscript>
  <div class="app">
    <div class="tabs"></div>

    <!-- DATA: you can tweak text/structure here without touching JS -->
    <script id="mk-data" type="application/json">
{
  "logo": "mykaarma_logo.png",
  "pages": [
    {
      "name": "Handoff & Review",
      "rows": [
        {"section": true, "label": "Handoff Notes"},

        /* (Per your request: removed first and last dropdown from this section) */
        {"label":"Deployment handoff?","type":"dropdown","options":["","Yes","No","N/A"],"indent":1},
        {"label":"ServiceCart handoff?","type":"dropdown","options":["","Yes","No","N/A"],"indent":1},
        {"label":"Scheduler handoff?","type":"dropdown","options":["","Yes","No","N/A"],"indent":1},

        {"section": true, "label": "Dealership Personnel"},
        {"label":"Does the personnel count in the admin tool appear accurate?","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Are all of the managers active?","type":"dropdown","options":["","Yes","No","N/A"],"indent":1},
        {"label":"Number of active/pending advisors?","type":"text","placeholder":"Enter count…","indent":1},
        {"label":"Number of active/pending parts reps?","type":"text","placeholder":"Enter count…","indent":1},
        {"label":"Number of active/pending techs?","type":"text","placeholder":"Enter count…","indent":1},
        {"label":"Number of active/pending BDC reps?","type":"text","placeholder":"Enter count…","indent":1},
        {"label":"Is the BDC onsite?","type":"dropdown","options":["","Yes","No","N/A"],"indent":2},
        {"label":"Do all of the users have DMS IDs in the admin tool?","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Do all of the advisors have direct dial numbers in the admin tool?","type":"dropdown","options":["","Yes","No","N/A"]},

        {"section": true, "label": "Location"},
        {"label":"How many buildings does Google Maps show?","type":"text"},
        {"label":"Were the correct numbers of buildings needing training accurately relayed in the handoff?","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"How many service drives does Google Maps show?","type":"text"},
        {"label":"Were the correct numbers of buildings needing training accurately relayed in the handoff? (Service drives)","type":"dropdown","options":["","Yes","No","N/A"]},

        {"section": true, "label": "Products"},

        {"subsection": true, "label": "Communication"},
        {"label":"Is the integration functioning properly? (historic pull, customer information, etc.)","type":"dropdown","options":["","Yes","No","N/A"],"indent":1},
        {"label":"Are texts and calls reaching the end user? (no errors)","type":"dropdown","options":["","Yes","No","N/A"],"indent":1},

        {"subsection": true, "label": "Payments"},
        {"label":"Is integration working correctly? (Dollar amount, descriptions, etc.)","type":"dropdown","options":["","Yes","No","N/A"],"indent":1},
        {"label":"Do the invoices sent to the customer appear correctly?","type":"dropdown","options":["","Yes","No","N/A"],"indent":1},

        {"subsection": true, "label": "ServiceCart"},

        {"subsection": true, "label": "Workflow", "depth": 2},
        {"label":"Does integration appear to be working correctly? (RO's pull, parts, etc.)","type":"dropdown","options":["","Yes","No","N/A"],"indent":1},
        {"label":"How many workflows were created?","type":"text","indent":1},
        {"label":"Do the workflows seem sensible?","type":"dropdown","options":["","Yes","No","N/A"],"indent":1},

        {"subsection": true, "label": "MPI", "depth": 2},
        {"label":"How many MPI forms were created?","type":"text","indent":1},

        {"subsection": true, "label": "Rules and Preventions", "depth": 2},
        {"label":"Do the MPI forms appear accurate and reasonable?","type":"dropdown","options":["","Yes","No","N/A"],"indent":1},
        {"label":"Are the creation and prevention rules in place and correct for each inspection type?","type":"dropdown","options":["","Yes","No","N/A"],"indent":1},

        {"subsection": true, "label": "Parts and Pricing", "depth": 2},
        {"label":"Have parts been uploaded for DMS types without integration?","type":"dropdown","options":["","Yes","No","N/A"],"indent":1},
        {"label":"Has a parts process been created for DMS types without integration?","type":"dropdown","options":["","Yes","No","N/A"],"indent":2},
        {"label":"Sales Tax %","type":"text","indent":1},
        {"label":"Shop Fees %","type":"text","indent":1},
        {"label":"Minimum Shop Fees %","type":"text","indent":1},
        {"label":"Maximum Shop Fees %","type":"text","indent":1},
        {"label":"Tax Shop Fees?","type":"dropdown","options":["","Yes","No","N/A"],"indent":1},

        {"subsection": true, "label": "Scheduler"},
        {"label":"Are the correct opcodes uploaded to correspond with the inspection questions?","type":"dropdown","options":["","Yes","No","N/A"],"indent":1},
        {"label":"Are there different teams in the shop? (Quicklane, repair, Sprinter, etc.)","type":"dropdown","options":["","Yes","No","N/A"],"indent":1},
        {"label":"Does the scheduler setup look correct? (hours, capacity, opcodes, labor codes, etc.)","type":"dropdown","options":["","Yes","No","N/A"],"indent":1},
        {"label":"Are there capacity rules?","type":"dropdown","options":["","Yes","No","N/A"],"indent":1},

        {"subsection": true, "label": "ServiceConnect"},
        {"label":"Are the automation rules set up and activated?","type":"dropdown","options":["","Yes","No","N/A"],"indent":1},

        {"section": true, "label": "Monday Visit – iOS Devices"},
        {"label":"Do the techs have iOS devices?","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"How many techs are using Android devices?","type":"text","indent":1},
        {"label":"Do all of the advisors have iOS devices?","type":"dropdown","options":["","Yes","0%","10%","20%","30%","40%","50%","60%","70%","80%","90%"]},
        {"label":"Were all of the devices set up and on the correct WiFi prior to your arrival?","type":"dropdown","options":["","Yes","No","N/A"]},

        {"section": true, "label": "Monday Visit – WiFi"},
        {"label":"Did the shop and drive pass the myKaarma WiFi speed test? (Focus on common dead spots)","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"What areas failed?","type":"text","indent":1},

        {"section": true, "label": "Dealership Expectations"},
        {"label":"Was the dealership aware of MCI prior to arrival?","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Who is involved in MCI?","type":"text"},
        {"label":"Did you go over the training agenda with the manager and set expectations?","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Tech video on every vehicle?","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Discuss all automations?","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Covered the Go-live date and plan?","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Did you inform the Service Manager of trainer arrival times (Tue/Thu 8:00 am, Wed at opening)?","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"What time will the Service Manager arrive at work each day?","type":"text"},

        {"section": true, "label": "Additional Comments"},
        {"label":"Additional Comments","type":"text","placeholder":"Type here…","wide": true}
      ]
    },

    {
      "name": "Contacts & WiFi",
      "rows": [
        {"section": true, "label": "WiFi Information"},
        {"label":"WiFi Name","type":"text"},
        {"label":"WiFi Password","type":"text"},

        {"section": true, "label": "Dealership Contacts"},
        {"label":"Primary Point Of Contact and Role","type":"dropdown","options":["","Service Advisor","Parts Rep","Technician","BDC Rep","Manager","Trainer","CEM","Product Champion"]},
        {"label":"Primary POC Cell","type":"text","indent":1},
        {"label":"Primary POC Email","type":"text","indent":1},

        {"label":"Additional POC and Role","type":"dropdown","options":["","Service Advisor","Parts Rep","Technician","BDC Rep","Manager","Trainer","CEM","Product Champion"]},
        {"label":"Additional POC Email","type":"text","indent":1},
        {"label":"Include in communications?","type":"dropdown","options":["","Yes","No","N/A"],"indent":1},

        {"label":"Additional POC and Role (2)","type":"dropdown","options":["","Service Advisor","Parts Rep","Technician","BDC Rep","Manager","Trainer","CEM","Product Champion"]},
        {"label":"Additional POC Email (2)","type":"text","indent":1},
        {"label":"Include in communications? (2)","type":"dropdown","options":["","Yes","No","N/A"],"indent":1},

        {"subsection": true, "label": "CEM"},
        {"label":"Customer Engagement Manager (CEM) Assigned to Store","type":"text"},

        {"subsection": true, "label": "Dealership Champions", "depth": 2},
        {"type":"nameRole","roleOptions":["","Service Advisor","Parts Rep","Technician","BDC Rep","Manager","Trainer","CEM","Product Champion"]},
        {"type":"nameRole","roleOptions":["","Service Advisor","Parts Rep","Technician","BDC Rep","Manager","Trainer","CEM","Product Champion"]},
        {"type":"nameRole","roleOptions":["","Service Advisor","Parts Rep","Technician","BDC Rep","Manager","Trainer","CEM","Product Champion"]},

        {"subsection": true, "label": "Blockers/Needs Work", "depth": 2},
        {"type":"nameRole","roleOptions":["","Service Advisor","Parts Rep","Technician","BDC Rep","Manager","Trainer","CEM","Product Champion"]},
        {"type":"nameRole","roleOptions":["","Service Advisor","Parts Rep","Technician","BDC Rep","Manager","Trainer","CEM","Product Champion"]},
        {"type":"nameRole","roleOptions":["","Service Advisor","Parts Rep","Technician","BDC Rep","Manager","Trainer","CEM","Product Champion"]},

        {"section": true, "label": "Training Team"},
        {"label":"Lead Trainer","type":"text"},
        {"label":"Additional Trainers","type":"text"},

        {"section": true, "label": "Additional Comments"},
        {"label":"Additional Comments","type":"text","wide": true}
      ]
    },

    {
      "name": "Training Readiness – Roles",
      "rows": [
        {"section": true, "label": "Technicians – Checklist"},
        {"label":"DMS ID","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Login","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Mobile App Menu","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Search Bar","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"RO Assignment","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Dispatch","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"RO History","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Prev. Declines","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Workflow","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"OCR","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Edit ASR","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"ShopChat / Parts","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Adding Media","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Status Change","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Notifications","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Filters","type":"dropdown","options":["","Yes","No","N/A"]},

        {"section": true, "label": "Parts Representatives – Checklist"},
        {"label":"DMS ID","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Login","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Web App Search Bar","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"\"Take\" Function","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"DMS History","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Prev. Declines","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Parts Tab","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Edit ASR","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Shopchat / Parts","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Status Change","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Notifications","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Filters","type":"dropdown","options":["","Yes","No","N/A"]},

        {"section": true, "label": "Service Advisors – Checklist"},
        {"label":"DMS ID","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Login","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Mobile App Menu","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Search Bar","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"RO Assignment","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"DMS History","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Prev. Declines","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Workflow","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"OCR","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Edit ASR","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Shopchat","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Status Change","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"MPI","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Send SOP","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"MCI","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"PU&D","type":"dropdown","options":["","Yes","No","N/A"]},

        {"section": true, "label": "BDC Representatives – Checklist"},
        {"label":"DMS ID","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Login","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Scheduler","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Declined Services","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"ServiceConnect","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Routing","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Notes (BDC)","type":"text","wide": true},

        {"section": true, "label": "Pick Up & Delivery Drivers – Checklist"},
        {"label":"DMS ID","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Login","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"PU&D","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Notifications","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Notes (PU&D)","type":"text","wide": true}
      ]
    },

    {
      "name": "Creation Opcodes",
      "rows": [
        {"section": true, "label": "Opcode Creation"},
        {"label":"Creation Opcode","type":"text"},
        {"label":"Creation Opcode for Customer MPI","type":"text"},
        {"label":"Creation Opcode for (enter info)","type":"text"},
        {"label":"Creation Opcode for (enter info)","type":"text"},

        {"section": true, "label": "Labor & Parts Setup"},
        {"label":"Updated Service / Opcode / Hours / Customer Pay Labor Rate","type":"text"},
        {"label":"Fixed Customer Pay Labor Rate","type":"text"},
        {"label":"Labor Charged – Set Parts Charged – Parts Retail – Service Cart","type":"text"},

        {"section": true, "label": "Common Services (enter pricing / notes)"},
        {"label":"2 Wheel Alignment","type":"text","placeholder":"$0.00"},
        {"label":"4 Spark Plug Replacement","type":"text","placeholder":"$0.00"},
        {"label":"6 Spark Plug Replacement","type":"text","placeholder":"$0.00"},
        {"label":"8 Spark Plug Replacement","type":"text","placeholder":"$0.00"},
        {"label":"Alignment","type":"text","placeholder":"$0.00"},
        {"label":"Battery Terminal Service","type":"text","placeholder":"$0.00"},
        {"label":"Brake Fluid Exchange","type":"text","placeholder":"$0.00"},
        {"label":"Cabin Air Filter","type":"text","placeholder":"$0.00"},
        {"label":"Conventional Oil Change","type":"text","placeholder":"$0.00"},
        {"label":"Conventional Oil Change with Tire Rotation","type":"text","placeholder":"$0.00"},
        {"label":"Coolant Fluid Exchange","type":"text","placeholder":"$0.00"},
        {"label":"Diagnosis","type":"text","placeholder":"$0.00"},
        {"label":"Diesel Oil Change","type":"text","placeholder":"$0.00"},
        {"label":"Engine Air Filter","type":"text","placeholder":"$0.00"},
        {"label":"Front Brake Pads and Machine Rotors","type":"text","placeholder":"$0.00"},
        {"label":"Front Brake Pads and New Rotors","type":"text","placeholder":"$0.00"},
        {"label":"Front Differential Service","type":"text","placeholder":"$0.00"}
      ]
    },

    {
      "name": "Creation Opcodes (cont.)",
      "rows": [
        {"label":"Front Wiper Blades","type":"text","placeholder":"$0.00"},
        {"label":"Fuel Additive","type":"text","placeholder":"$0.00"},
        {"label":"Fuel Filter","type":"text","placeholder":"$0.00"},
        {"label":"Fuel Injection/Induction Service","type":"text","placeholder":"$0.00"},
        {"label":"Left Headlight Bulb","type":"text","placeholder":"$0.00"},
        {"label":"Light Bulb Replacement","type":"text","placeholder":"$0.00"},
        {"label":"Miscellaneous","type":"text","placeholder":"$0.00"},
        {"label":"Mount & Balance 1 Tire","type":"text","placeholder":"$0.00"},
        {"label":"Mount & Balance 2 Tires","type":"text","placeholder":"$0.00"},
        {"label":"Mount & Balance 3 Tires","type":"text","placeholder":"$0.00"},
        {"label":"Mount & Balance 4 Tires","type":"text","placeholder":"$0.00"},
        {"label":"Power Steering Fluid Exchange","type":"text","placeholder":"$0.00"},
        {"label":"Rear Brake Pads and Machine Rotors","type":"text","placeholder":"$0.00"},
        {"label":"Rear Brake Pads and New Rotors","type":"text","placeholder":"$0.00"},
        {"label":"Rear Differential Service 3 Qts","type":"text","placeholder":"$0.00"},
        {"label":"Rear Differential Service 4 Qts","type":"text","placeholder":"$0.00"},
        {"label":"Rear Wiper Blade","type":"text","placeholder":"$0.00"},
        {"label":"Recall/Campaign","type":"text","placeholder":"$0.00"},
        {"label":"Replace 12V Battery","type":"text","placeholder":"$0.00"},
        {"label":"Replace Key FOB Battery","type":"text","placeholder":"$0.00"},
        {"label":"Right Headlight Bulb","type":"text","placeholder":"$0.00"},
        {"label":"Serpentine Drive Belt","type":"text","placeholder":"$0.00"},
        {"label":"State Inspection","type":"text","placeholder":"$0.00"},
        {"label":"State Inspection Emissions","type":"text","placeholder":"$0.00"},
        {"label":"Synthetic Oil Change","type":"text","placeholder":"$0.00"},
        {"label":"Synthetic Oil Change with Tire Rotation","type":"text","placeholder":"$0.00"},
        {"label":"Tire Balance","type":"text","placeholder":"$0.00"},
        {"label":"Tire Patch","type":"text","placeholder":"$0.00"},
        {"label":"Tire Plug","type":"text","placeholder":"$0.00"}
      ]
    },

    {
      "name": "Creation Opcodes (final)",
      "rows": [
        {"label":"Tire Rotation","type":"text","placeholder":"$0.00"},
        {"label":"Tire Rotation & Balance","type":"text","placeholder":"$0.00"},
        {"label":"Transfer Case Service","type":"text","placeholder":"$0.00"},
        {"label":"Transmission Fluid Exchange","type":"text","placeholder":"$0.00"},

        {"section": true, "label": "Verified Customers"},
        {"label":"MPI Opcode – MPI Line – MPI Preselected Opcode","type":"text"},

        {"section": true, "label": "MPI Lines (enter opcode / notes)"},
        {"label":"Exterior Lights 1","type":"text"},
        {"label":"Front Wiper Blades 2","type":"text"},
        {"label":"Rear Wiper Blade 3","type":"text"},
        {"label":"Warning Lights 4","type":"text"},
        {"label":"Engine Air Filter 5","type":"text"},
        {"label":"Cabin Air Filter 6","type":"text"},
        {"label":"Battery Mountings, Terminals, and Wires 7","type":"text"},
        {"label":"12V Battery 8","type":"text"},
        {"label":"Engine Oil 9","type":"text"},
        {"label":"Brake Fluid 10","type":"text"},
        {"label":"Transmission Fluid 11","type":"text"},
        {"label":"Coolant Fluid 12","type":"text"},
        {"label":"Power Steering Fluid 13","type":"text"},
        {"label":"Hoses and Clamps 14","type":"text"},
        {"label":"Drive Belt 15","type":"text"},
        {"label":"Fluid Leaks 16","type":"text"},
        {"label":"Steering Components 17","type":"text"},
        {"label":"Engine/Transmission Mounts 18","type":"text"},
        {"label":"CV Boots 19","type":"text"},
        {"label":"Suspension 20","type":"text"},
        {"label":"Drive Shaft 21","type":"text"},
        {"label":"Exhaust System 22","type":"text"},
        {"label":"Front Brake Pads 23","type":"text"},
        {"label":"Rear Brake Pads 24","type":"text"},
        {"label":"Tire Tread Depth 25","type":"text"},
        {"label":"Tire Wear Pattern 26","type":"text"},
        {"label":"27","type":"text"},
        {"label":"28","type":"text"},
        {"label":"29","type":"text"},
        {"label":"30","type":"text"},
        {"label":"31","type":"text"},
        {"label":"32","type":"text"}
      ]
    },

    {
      "name": "DMS Integration",
      "rows": [
        {"section": true, "label": "Push-Based DMS – Reference Matrix Notes"},
        {"label":"Product Integration Notes","type":"text","wide": true},
        {"section": true, "label": "Pull-Based DMS – Reference Matrix Notes"},
        {"label":"Additional Integration Notes","type":"text","wide": true}
      ]
    },

    {
      "name": "Workflow Notifications",
      "rows": [
        {"section": true, "label": "MPI Customer Pay Workflow – Status Notifications"},
        {"label":"Unassigned","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Dispatched/Not Started","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"MPI & Diag in Progress","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Quote Parts","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Advisor Review","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Pending Customer Approval","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Approved - Pull/Order Parts","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Ready for Tech - Parts Here/Pulled","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Ordered Parts","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Working in Shop","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Vehicle Complete","type":"dropdown","options":["","Yes","No","N/A"]},
        {"label":"Not Needed","type":"dropdown","options":["","Yes","No","N/A"]},

        {"section": true, "label": "Notes"},
        {"label":"Notes","type":"text","wide": true}
      ]
    },

    {
      "name": "Training Summary Notes",
      "rows": [
        {"section": true, "label": "Pre-Training & Monday Visit Notes"},
        {"label":"Notes","type":"text","wide": true},

        {"section": true, "label": "Tuesday Training Notes"},
        {"label":"Notes","type":"text","wide": true},

        {"section": true, "label": "Wednesday Training Notes"},
        {"label":"Notes","type":"text","wide": true},

        {"section": true, "label": "Thursday Training Notes"},
        {"label":"Notes","type":"text","wide": true},

        {"section": true, "label": "Training Note Summary"},
        {"label":"Notes","type":"text","wide": true}
      ]
    }
  ]
}
    </script>
  </div>

  <script>
    // Visible error reporting
    window.onerror = function(msg, src, line, col){
      const app = document.querySelector('.app'); if(!app) return;
      const warn = document.createElement('div'); warn.className = 'warn';
      warn.textContent = 'Error: ' + msg + ' at ' + (line||'?') + ':' + (col||'?');
      app.prepend(warn);
    };

    // CSS.escape polyfill (for older Safari)
    if (typeof CSS === 'undefined' || typeof CSS.escape !== 'function') {
      window.CSS = window.CSS || {};
      window.CSS.escape = function (v) { return String(v).replace(/[^a-zA-Z0-9_\-]/g, '\\$&'); };
    }

    // Load SEED JSON
    let SEED = null;
    (function(){
      try {
        SEED = JSON.parse(document.getElementById('mk-data').textContent);
      } catch (e) {
        const app = document.querySelector('.app');
        const warn = document.createElement('div');
        warn.className = 'warn';
        warn.textContent = 'Could not parse mk-data JSON: ' + e.message;
        app.prepend(warn);
        throw e;
      }
    })();

    // Helpers
    function indentLevelFromLabel(label){
      if(!label) return 0; let level = 0;
      const m = label.match(/^([ \t]+)/); if(m){ level = Math.min(4, Math.floor(m[1].length / 2)); }
      if (/^[ \t]*[-–—•>|»]\s+/.test(label)) level = Math.min(4, level + 1);
      return level;
    }
    function cleanLabel(label){ if(!label) return ""; return label.replace(/^[ \t]*[-–—•>|»]\s+/, "").trimStart(); }

    const tabsBar = document.querySelector('.tabs');
    const app = document.querySelector('.app');

    // Global dealership subline sync
    const SUBLINE_KEY = 'mkChecklist:dealershipSubline';
    function getSubline(){ return localStorage.getItem(SUBLINE_KEY) || ''; }
    function setSubline(val){
      localStorage.setItem(SUBLINE_KEY, val || '');
      document.querySelectorAll('.header-subline').forEach(el => el.textContent = val || '');
    }

    function buildPage(pg){
      const page = document.createElement('section'); page.className = 'page'; page.dataset.page = pg.name;

      // Header (logo left, title above subline)
      const header = document.createElement('div'); header.className = 'page-header';
      const img = document.createElement('img'); img.className = 'logo'; img.alt = 'myKaarma logo';
      if(SEED.logo){ img.src = SEED.logo; } else { img.style.display = 'none'; }

      const title = document.createElement('h1'); title.className = 'header-title';
      title.textContent = 'Onsite Training Checklist';

      const sub = document.createElement('div');
      sub.className = 'header-subline';
      sub.setAttribute('contenteditable','true');
      sub.setAttribute('data-ph','Enter the dealership name & DID');
      sub.textContent = getSubline();

      header.appendChild(img);
      header.appendChild(title);
      header.appendChild(document.createElement('div')); // spacer in grid second row first col is logo
      header.appendChild(sub);
      page.appendChild(header);

      // Toolbar
      const toolbar = document.createElement('div');
      toolbar.className = 'toolbar';
      toolbar.innerHTML = `
        <button class="btn" data-action="savePage">Save page</button>
        <button class="btn" data-action="loadPage">Load page</button>
        <button class="btn" data-action="exportAll">Export all</button>
        <label class="btn file">Import <input type="file" class="import" accept="application/json"></label>
        <button class="btn outline" data-action="print">Save as PDF</button>
      `;
      page.appendChild(toolbar);

      // Build sections
      const rows = pg.rows || [];
      let sectionBody = null;
      let currentSubgroup = null;

      function startSection(titleText){
        const sec = document.createElement('div'); sec.className = 'section';
        const st = document.createElement('div'); st.className = 'section-title'; st.textContent = titleText || '';
        sec.appendChild(st);
        sectionBody = document.createElement('div'); sectionBody.className = 'section-body';
        sec.appendChild(sectionBody);
        page.appendChild(sec);
        currentSubgroup = null;
      }
      function addSubsection(titleText, depth){
        const sst = document.createElement('div');
        sst.className = 'subsection-title' + (depth === 2 ? ' level-2' : '');
        sst.textContent = titleText || '';
        if(!sectionBody){ startSection(''); }
        sectionBody.appendChild(sst);

        // If depth 2, create connected group box under it
        if(depth === 2){
          currentSubgroup = document.createElement('div');
          currentSubgroup.className = 'subgroup';
          sectionBody.appendChild(currentSubgroup);
        } else {
          currentSubgroup = null;
        }
      }

      rows.forEach((row, i) => {
        if(row.section){ startSection(row.label || ''); return; }
        if(row.subsection){ addSubsection(row.label || '', row.depth || 1); return; }
        if(!sectionBody){ startSection(''); }

        // Special Name+Role row
        if(row.type === 'nameRole'){
          const host = currentSubgroup || sectionBody;
          const q = document.createElement('div'); q.className = 'q';
          const wrap = document.createElement('div'); wrap.className = 'q-row';
          const left = document.createElement('input'); left.className = 'textinput'; left.placeholder = 'Name';
          left.id = (pg.name + '__name_role_left__' + i).replace(/\s+/g,'_');
          const right = document.createElement('select'); right.className = 'select';
          right.id = (pg.name + '__name_role_right__' + i).replace(/\s+/g,'_');
          (row.roleOptions || ["","Service Advisor","Parts Rep","Technician","BDC Rep","Manager","Trainer","CEM","Product Champion"])
            .forEach(o => { const opt=document.createElement('option'); opt.value=o; opt.textContent=o; right.appendChild(opt); });
          // put input (left) and dropdown (right)
          wrap.appendChild(left); wrap.appendChild(right);
          q.appendChild(wrap); host.appendChild(q);
          return;
        }

        const indent = (row.indent ?? indentLevelFromLabel(row.label || ''));
        const labelText = cleanLabel(row.label || '');
        const host = currentSubgroup || sectionBody;

        const q = document.createElement('div'); q.className = 'q indent-'+Math.max(0, Math.min(4, indent));
        const rowWrap = document.createElement('div'); rowWrap.className = 'q-row';

        const isNotes = row.wide || /additional comments|notes$/i.test(labelText);
        if(isNotes) rowWrap.classList.add('wide');

        const lab = document.createElement('div'); lab.className = 'label'; lab.textContent = labelText || 'Field';

        let fieldEl;
        if (row.type === 'dropdown' && Array.isArray(row.options)){
          fieldEl = document.createElement('select'); fieldEl.className = 'select';
          fieldEl.id = (pg.name + '__' + (labelText || ('row'+i))).replace(/\s+/g, '_');
          const opts = (row.options.length && row.options[0] === '') ? row.options : [''].concat(row.options);
          opts.forEach(o => { const opt = document.createElement('option'); opt.value = o; opt.textContent = o; fieldEl.appendChild(opt); });
        } else if (row.type === 'text') {
          if(isNotes){
            fieldEl = document.createElement('textarea'); fieldEl.className = 'textarea';
            fieldEl.id = (pg.name + '__' + (labelText || ('row'+i))).replace(/\s+/g, '_');
            fieldEl.placeholder = row.placeholder || 'Type here…';
          } else {
            fieldEl = document.createElement('input'); fieldEl.type='text'; fieldEl.className='textinput';
            fieldEl.id = (pg.name + '__' + (labelText || ('row'+i))).replace(/\s+/g, '_');
            fieldEl.placeholder = row.placeholder || 'Type here…';
          }
        } else {
          fieldEl = document.createElement('textarea'); fieldEl.className = 'textarea';
          fieldEl.id = (pg.name + '__' + (labelText || ('row'+i))).replace(/\s+/g, '_');
          fieldEl.placeholder = row.placeholder || 'Type here…';
        }

        if(isNotes){
          rowWrap.appendChild(fieldEl);
        }else{
          rowWrap.appendChild(lab);
          rowWrap.appendChild(fieldEl);
        }
        q.appendChild(rowWrap);
        host.appendChild(q);
      });

      // Footer (inline)
      const footer = document.createElement('div'); footer.className = 'footer';
      footer.innerHTML = `
        <div class="fblock"><span>Trainer Name:</span> <span class="line"></span></div>
        <div class="fblock"><span>Date:</span> <span class="line"></span></div>
        <div class="fblock"><span>Dealership:</span> <span class="line"></span></div>
      `;
      page.appendChild(footer);

      // Save/Load/Export/Import
      const key = () => 'mkChecklist:'+pg.name;
      const collect = () => { const data = { fields: {} }; page.querySelectorAll('select, textarea, input.textinput').forEach(el => data.fields[el.id] = el.value); return data; };
      const apply = (data) => { if(!data) return; Object.entries(data.fields || {}).forEach(([id,val]) => { const el = page.querySelector('#'+CSS.escape(id)); if(el) el.value = val; autoGrow(el); }); };
      const save = () => { localStorage.setItem(key(), JSON.stringify(collect())); };
      const load = () => { const raw = localStorage.getItem(key()); if(raw) apply(JSON.parse(raw)); };

      page.addEventListener('input', (e) => {
        if(e.target.matches('.header-subline')){
          setSubline(e.target.textContent.trim());
        } else if(e.target.matches('select, textarea, input.textinput')){
          autoGrow(e.target);
          save();
        }
      });

      setTimeout(()=>page.querySelectorAll('textarea').forEach(autoGrow), 0);

      toolbar.querySelector('[data-action="savePage"]').addEventListener('click', () => { save(); alert('Page saved.'); });
      toolbar.querySelector('[data-action="loadPage"]').addEventListener('click', () => { load(); alert('Page loaded.'); });
      toolbar.querySelector('[data-action="exportAll"]').addEventListener('click', exportAll);
      toolbar.querySelector('.import').addEventListener('change', importAll);
      toolbar.querySelector('[data-action="print"]').addEventListener('click', () => window.print());

      function exportAll(){
        const all = { dealershipSubline: getSubline() };
        document.querySelectorAll('.page').forEach(pgEl => {
          const fields = {};
          pgEl.querySelectorAll('select, textarea, input.textinput').forEach(el => fields[el.id] = el.value);
          all[pgEl.dataset.page] = { fields };
        });
        const blob = new Blob([JSON.stringify(all, null, 2)], {type:'application/json'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'onsite_checklist_data.json'; a.click();
        URL.revokeObjectURL(a.href);
      }
      function importAll(e){
        const file = e.target.files[0]; if(!file) return;
        const reader = new FileReader();
        reader.onload = () => {
          try{
            const data = JSON.parse(reader.result);
            if(typeof data.dealershipSubline === 'string'){ setSubline(data.dealershipSubline); }
            document.querySelectorAll('.page').forEach(pgEl => {
              const d = data[pgEl.dataset.page]; if(!d) return;
              Object.entries(d.fields || {}).forEach(([id,val]) => {
                const el = pgEl.querySelector('#'+CSS.escape(id)); if(el){ el.value = val; autoGrow(el); }
              });
            });
            alert('Imported data applied.');
          }catch(err){ alert('Invalid JSON.'); }
        };
        reader.readAsText(file);
      }

      return page;
    }

    function autoGrow(el){
      if(el && el.tagName === 'TEXTAREA'){
        el.style.height = 'auto';
        el.style.height = (el.scrollHeight + 2) + 'px';
      }
    }

    // Build all pages + tabs
    const pages = (SEED.pages || []).map(buildPage);
    pages.forEach((pg,i) => {
      document.querySelector('.app').appendChild(pg);
      const t = document.createElement('button'); t.className = 'tab'; t.textContent = pg.dataset.page;
      t.addEventListener('click', () => setActive(i));
      tabsBar.appendChild(t);
    });

    function setActive(i){
      pages.forEach((p,j)=>p.classList.toggle('active', i===j));
      [...tabsBar.children].forEach((t,j)=>t.classList.toggle('active', i===j));
      // load saved page data
      const raw = localStorage.getItem('mkChecklist:'+pages[i].dataset.page);
      if(raw){
        try{
          const data = JSON.parse(raw);
          Object.entries(data.fields || {}).forEach(([id,val])=>{
            const el = pages[i].querySelector('#'+CSS.escape(id));
            if(el){ el.value = val; autoGrow(el); }
          });
        }catch(_e){}
      }
      // sync dealership line
      document.querySelectorAll('.header-subline').forEach(el => el.textContent = getSubline());
    }
    setActive(0);
  </script>
</body>
</html>
